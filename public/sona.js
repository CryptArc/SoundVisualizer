"use strict";var config={author:"sona",version:"1.0.0",soundcloud_client_id:"802c2f1c80c96881ff265799929e8a2c"},dom=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function n(n){return"string"===e(n)}function t(e){return!!e&&1===e.nodeType}function i(e){return 9===e.nodeType}function r(e,n){if(e)throw new Error(n)}function o(e,o){return r(!n(e),"arguments must be string type"),o=(n(o)?a(o):o)||document,r(!t(o)&&!i(o),"Second Element must be element node"),o.querySelectorAll(e)}function a(e,n){return o(e,n)[0]}function u(e,t){r(!n(t),"arguments must be string type");var i=e.className.split(" ");return i.indexOf(t)!==-1}function c(e,t){r(!n(t),"arguments must be string type"),u(e,t)||(e.className=e.className+" "+t)}function s(e,n){u(e,n)?e.className=e.className.split(" ")[0]:c(e,n)}function l(e){e=(n(e)?a(e):e)||document,e.style.display="block"}function d(e){e=(n(e)?a(e):e)||document,e.style.display="none"}function q(e){var n=/https:\/\/soundcloud.com\/[0-9a-z-]+\/[0-9a-z-]+/;return n.test(e)}return{info:{author:config.author,version:config.version},util:{toggle:s,isCorrectSoundCloudURL:q},query:a,show:l,hide:d}}(),sona=function(){function e(){s.clearRect(0,0,c.width,c.height),s.beginPath(),s.rect(0,0,c.width,c.height);var e=Math.floor(2*Math.random()),n=s.createLinearGradient(0,0,1500,0);n.addColorStop(0,h[e][0]),n.addColorStop(1,h[e][1]),s.fillStyle=n,s.fill()}function n(){a&&(a.width=window.innerWidth,a.height=window.innerHeight,c.width=window.innerWidth,c.height=window.innerHeight,e())}function t(){var e,n,i=0,r=d.frequencyBinCount,o=new Uint8Array(r),c=a.width/r*2.5;d.getByteFrequencyData(o),u.clearRect(-a.width,-a.height,2*a.width,2*a.height);for(var s=0,l=r;s<l;s++)n=o[s],e=3*n,u.fillStyle="rgba("+(n+200)+", "+(n+200)+","+(n+200)+", 0.4)",u.fillRect(i,a.height-e/2+100,c,e/100),u.fillRect(i,a.height-e/2,c,e/2),u.beginPath(),u.arc(i,a.height-e/2-90,c/3,0,2*Math.PI,!1),u.fill(),i+=c+1;requestAnimationFrame(t)}function i(e){l.setAttribute("src",e)}function r(){clearInterval(f)}function o(e){d=e.analyser,q=e.canvas,a=document.createElement("canvas"),a.className="fgCanvas",u=a.getContext("2d"),q.appendChild(a),l=document.createElement("img"),l.className="imgCanvas",q.appendChild(l),c=document.createElement("canvas"),s=c.getContext("2d"),q.appendChild(c),n(),t(),window.addEventListener("resize",n,!1)}var a,u,c,s,l,d,q,f,h={0:["#00c9de","#fc19ff"],1:["#00DBDE","#FC00FF"]};return{info:{version:config.version,author:config.author},init:o,drawAlbumImg:i,clearBackEffect:r}}(),sound=function(e){function n(i){return this instanceof n?void this._init.apply(this,arguments):(e.initialize({client_id:t}),new n(i))}var t=config.soundcloud_client_id;return n.fn=n.prototype={constructor:n,author:config.author,version:config.version,_init:function(e){var n=new(window.AudioContext||window.webkitAudioContext),t=n.createMediaElementSource(e);this.audio=e,this.analyser=n.createAnalyser(),this.analyser.fftSize=256,this.analyser.connect(n.destination),this.audio.crossOrigin="anonymous",t.connect(this.analyser)},search:function(n,i,r){e.resolve(n).then(function(e){if(e.stream_url){var n=e.stream_url+"?client_id="+t,o=e.artwork_url;i.call(this,n,o)}else r("Playlist is not supported")}).catch(function(e){r(e)})},play:function(e){this.audio.src="data:audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",this.audio.setAttribute("src",e),this.audio.play()}},n}(SC);!function(e,n,t){function i(){var e=window.navigator.userAgent,n=e.indexOf("MSIE ");if(n>0)return parseInt(e.substring(n+5,e.indexOf(".",n)),10);var t=e.indexOf("Trident/");if(t>0){var i=e.indexOf("rv:");return parseInt(e.substring(i+3,e.indexOf(".",i)),10)}var r=e.indexOf("Edge/");return r>0&&parseInt(e.substring(r+5,e.indexOf(".",r)),10)}function r(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=n.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function o(n){y.search(n,function(n,i){e.show(d),e.hide(q),y.play(n),t.drawAlbumImg(i),setTimeout(p.toggle(h,"ctrgroup--hidden"),3e3)},function(n){403===n.status?e.query(".warnPanel__p").innerHTML="This song is not supported":e.query(".warnPanel__p").innerHTML=n,e.show(q)})}var a=i();a&&a<12&&(e.query(".layer").style.display="table");var u="track",c=e.query(".ctrgroup__player__form"),s=e.query(".ctrgroup__togglebtn"),l=e.query(".ctrgroup__player__form__input"),d=e.query(".visualPanel"),q=e.query(".warnPanel"),f=e.query(".defaultPanel"),h=e.query(".ctrgroup"),g=e.query(".ctrgroup__player__audio"),p=e.util,y=n(g);if(t.init({analyser:y.analyser,canvas:d}),p.toggle(h,"ctrgroup--hidden"),e.hide(d),r(u)){var w=r(u);l.value=w,o(w)}c.addEventListener("submit",function(n){n.preventDefault(),e.hide(f),p.isCorrectSoundCloudURL(l.value)?o(l.value):(e.query(".warnPanel__p").innerHTML="invalid soundcloud url",e.show(q))}),s.addEventListener("click",function(e){e.preventDefault(),p.toggle(h,"ctrgroup--hidden")}),g.addEventListener("ended",function(){e.show(d),t.clearBackEffect()}),window.addEventListener("keydown",function(e){32===e.which&&(g.paused?g.play():g.pause())})}(dom,sound,sona);